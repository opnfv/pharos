##############################################################################
# Copyright (c) 2018 Mirantis Inc., Enea AB and others.
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
##############################################################################
{%- import 'net_map.j2' as nm with context %}
---
{%- if nm.cluster.has_baremetal_nodes %}
parameters:
  maas:
    region:
      machines:
{%- for node in conf.nodes %}
{%- if node.node.type == 'baremetal' %}

{%- if loop.index > nm.cmp001.idx %}
        {{ 'cmp%03d' | format(loop.index - nm.cmp001.idx) }}:
{%- else %}
        {{ 'kvm%02d' | format(loop.index) }}:
{%- endif %}
          interface:
            mac: {{ node.interfaces[nm.idx_admin].mac_address }}
          power_parameters:
            power_address: {{ node.remote_management.address.rsplit('/')[0] }}
            power_password: {{ node.remote_management.pass }}
            power_type: {{ node.remote_management.type }}
            power_user: {{ node.remote_management.user }}
          architecture: {{ node.node.arch | dpkg_arch }}/generic
          distro_series: xenial
          hwe_kernel: ${_param:hwe_kernel}

{%- endif %}
{%- endfor %}
{%- endif %}
