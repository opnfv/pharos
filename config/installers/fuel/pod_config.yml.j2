{%- if conf.net_config is defined -%}
    {%- set net_admin = conf['net_config']['admin']['network'] -%}
    {%- set net_mgmt = conf['net_config']['mgmt']['network'] -%}
    {%- set net_private = conf['net_config']['private']['network'] -%}
    {%- set net_public = conf['net_config']['public']['network'] -%}
    {%- if conf.net_config.public.dns is defined -%}
        {%- set dns_public = conf['net_config']['public']['dns'] -%}
    {%- endif -%}
    {%- set vlan_mgmt = conf['net_config']['mgmt']['vlan'] -%}
    {%- set vlan_private = conf['net_config']['private']['vlan'] -%}
{%- else -%}
    {#- TODO: Try to dynamically detect networks from PDF -#}
    {#- For now, we just provide some dummy default values -#}
    {%- set net_admin = '192.168.11.0' -%}
    {%- set net_mgmt = '172.16.10.0' -%}
    {%- set net_private = '10.1.0.0' -%}
    {%- set net_public = '172.30.10.0' -%}
    {%- set vlan_mgmt = '300' -%}
    {%- set vlan_private = '302' -%}
{%- endif -%}
{%- if dns_public is not defined -%}
    {%- set dns_public = [ '8.8.8.8', '8.8.4.4' ] -%}
{%- endif -%}
---
parameters:
  _param:
    # infra service addresses
    opnfv_infra_config_address: {{ net_mgmt | ipaddr_index('100') }}
    opnfv_infra_maas_node01_address: {{ net_mgmt | ipaddr_index('3') }}
    opnfv_infra_maas_node01_deploy_address: {{ net_admin | ipaddr_index('3') }}
    opnfv_infra_compute_node01_address: {{ net_mgmt | ipaddr_index('141') }}
    opnfv_infra_compute_node02_address: {{ net_mgmt | ipaddr_index('142') }}
    opnfv_infra_compute_node03_address: {{ net_mgmt | ipaddr_index('143') }}
    opnfv_infra_kvm_address: {{ net_mgmt | ipaddr_index('140') }}
    opnfv_infra_kvm_node01_address: {{ net_mgmt | ipaddr_index('141') }}
    opnfv_infra_kvm_node02_address: {{ net_mgmt | ipaddr_index('142') }}
    opnfv_infra_kvm_node03_address: {{ net_mgmt | ipaddr_index('143') }}

    opnfv_openstack_gateway_node01_address: {{ net_mgmt | ipaddr_index('124') }}
    opnfv_openstack_gateway_node02_address: {{ net_mgmt | ipaddr_index('125') }}
    opnfv_openstack_gateway_node03_address: {{ net_mgmt | ipaddr_index('126') }}
    opnfv_openstack_gateway_node01_tenant_address: {{ net_private | ipaddr_index('6') }}
    opnfv_openstack_gateway_node02_tenant_address: {{ net_private | ipaddr_index('7') }}
    opnfv_openstack_gateway_node03_tenant_address: {{ net_private | ipaddr_index('9') }}
    opnfv_openstack_proxy_address: {{ net_mgmt | ipaddr_index('80') }}
    opnfv_openstack_proxy_node01_address: {{ net_mgmt | ipaddr_index('81') }}
    opnfv_openstack_proxy_node02_address: {{ net_mgmt | ipaddr_index('82') }}
    opnfv_openstack_control_address: {{ net_mgmt | ipaddr_index('10') }}
    opnfv_openstack_control_node01_address: {{ net_mgmt | ipaddr_index('11') }}
    opnfv_openstack_control_node02_address: {{ net_mgmt | ipaddr_index('12') }}
    opnfv_openstack_control_node03_address: {{ net_mgmt | ipaddr_index('13') }}
    opnfv_openstack_database_address: {{ net_mgmt | ipaddr_index('50') }}
    opnfv_openstack_database_node01_address: {{ net_mgmt | ipaddr_index('51') }}
    opnfv_openstack_database_node02_address: {{ net_mgmt | ipaddr_index('52') }}
    opnfv_openstack_database_node03_address: {{ net_mgmt | ipaddr_index('53') }}
    opnfv_openstack_message_queue_address: {{ net_mgmt | ipaddr_index('40') }}
    opnfv_openstack_message_queue_node01_address: {{ net_mgmt | ipaddr_index('41') }}
    opnfv_openstack_message_queue_node02_address: {{ net_mgmt | ipaddr_index('42') }}
    opnfv_openstack_message_queue_node03_address: {{ net_mgmt | ipaddr_index('43') }}
    opnfv_openstack_telemetry_address: {{ net_mgmt | ipaddr_index('75') }}
    opnfv_openstack_telemetry_node01_address: {{ net_mgmt | ipaddr_index('76') }}
    opnfv_openstack_telemetry_node02_address: {{ net_mgmt | ipaddr_index('77') }}
    opnfv_openstack_telemetry_node03_address: {{ net_mgmt | ipaddr_index('78') }}
    opnfv_openstack_compute_node01_single_address: {{ net_mgmt | ipaddr_index('101') }}
    opnfv_openstack_compute_node02_single_address: {{ net_mgmt | ipaddr_index('102') }}
    opnfv_openstack_compute_node03_single_address: {{ net_mgmt | ipaddr_index('103') }}
    opnfv_openstack_compute_node01_control_address: {{ net_mgmt | ipaddr_index('101') }}
    opnfv_openstack_compute_node02_control_address: {{ net_mgmt | ipaddr_index('102') }}
    opnfv_openstack_compute_node03_control_address: {{ net_mgmt | ipaddr_index('103') }}
    opnfv_openstack_compute_node01_tenant_address: {{ net_private | ipaddr_index('101') }}
    opnfv_openstack_compute_node02_tenant_address: {{ net_private | ipaddr_index('102') }}
    opnfv_openstack_compute_node03_tenant_address: {{ net_private | ipaddr_index('103') }}
    opnfv_openstack_compute_node01_external_address: {{ net_public | ipaddr_index('101') }}
    opnfv_openstack_compute_node02_external_address: {{ net_public | ipaddr_index('102') }}

    opnfv_name_servers: {{ dns_public }}
    opnfv_dns_server01: '{{ dns_public[0] }}'
    opnfv_net_mgmt_vlan: {{ vlan_mgmt }}
    opnfv_net_tenant_vlan: {{ vlan_private }}

{%- for idx in conf['nodes'] %}
{% set node_idx = 'opnfv_maas_node%02d' % loop.index %}
    # Node {{ '%02d' % loop.index }} specific configuration
    {{ node_idx }}_architecture: '{{ idx['node']['arch'] | dpkg_arch }}/generic'
    {{ node_idx }}_power_address: {{ idx['remote_management']['address'] }}
    {{ node_idx }}_power_type: {{ idx['remote_management']['type'] }}
    {{ node_idx }}_power_user: {{ idx['remote_management']['user'] }}
    {{ node_idx }}_power_password: {{ idx['remote_management']['pass'] }}
{%- if idx['interfaces'][1]['mac_address'] is defined %}
    {{ node_idx }}_interface_mac: '{{ idx['interfaces'][1]['mac_address'] }}'
{%- else %}
    {{ node_idx }}_interface_mac: '{{ idx['interfaces'][1] }}'
{%- endif %}
{%- endfor %}
